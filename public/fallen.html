<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fallen Tributes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; background:#111; color:white; font-family:system-ui,sans-serif; padding:20px; }
h1 { text-align:center; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:20px; max-width:1200px; margin:auto; }
.card { background:rgba(30,30,30,.8); border-radius:12px; padding:12px; text-align:center; }
img { width:150px; height:150px; border-radius:50%; border:4px solid #444; }
.name { margin:8px 0 4px; font-size:18px; font-weight:bold; }
.order { color:#aaa; font-size:14px; }
#reset { position:fixed; bottom:20px; right:20px; padding:12px 24px; font-size:16px; background:#c00; color:white; border:none; border-radius:8px; cursor:pointer; display:none; }
#adminPass { position:fixed; bottom:70px; right:20px; padding:8px; width:200px; }
</style>
</head>
<body>
<h1>Fallen Tributes</h1>
<div id="grid" class="grid"></div>
<input type="password" id="adminPass" placeholder="Enter admin password">
<button id="reset">Admin Reset</button>

<script>
function generatePassword() {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";
  let pass = "";
  for (let i = 0; i < 16; i++) {
    pass += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return pass;
}

const ADMIN_PASS = generatePassword();
console.log("Admin password:", ADMIN_PASS);  // Check console for new password each load

document.getElementById("adminPass").addEventListener("keydown", e => {
  if (e.key === "Enter" && e.target.value === ADMIN_PASS) {
    document.getElementById("reset").style.display = "block";
    e.target.style.display = "none";
  }
});

async function loadFallen(){
  const res = await fetch("/dead");
  if (!res.ok) return;
  const data = await res.json();
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  data.reverse().forEach((p, i) => {
    const card = document.createElement("div");
    card.className = "card";
    const img = document.createElement("img");
    img.src = `https://www.roblox.com/bust-thumbnail/image?userId=${p.id}&width=420&height=420&format=png`;
    const name = document.createElement("div");
    name.className = "name";
    name.textContent = p.name;
    const order = document.createElement("div");
    order.className = "order";
    order.textContent = `${data.length - i}th Fallen`;
    card.append(img, name, order);
    grid.appendChild(card);
  });
}

document.getElementById("reset").addEventListener("click", async () => {
  if (confirm("Reset all fallen tributes?")) {
    await fetch("/reset-dead", { method: "POST" });
    loadFallen();
  }
});

loadFallen();
setInterval(loadFallen, 5000);
</script>
</body>
</html>
